<apex:page controller="ApiCallEmbedController">
  <h1>Nothing to see here.</h1>
  <apex:form>
    <apex:actionFunction name="setReady" action="{!setReady}" rerender="poster">
    </apex:actionFunction>
  </apex:form>

  <div id="poster">
    <script render="readyToSend">
      let targetWindow = window.parent;
      const passBackOrigin = `{!JSENCODE(targetOrigin)}`;
      if (targetWindow) {
        targetWindow.postMessage({ data: JSON.parse(`{!JSENCODE(pageLayoutDescribeResponse)}`), object: `{!JSENCODE(objectApiName)}` }, passBackOrigin);
      }
    </script>
  </div>
  <script>
    const targetOrigin = `{!JSENCODE(targetOrigin)}`;
    console.log(targetOrigin);
    const listener = ({ origin, data }) => {
      if (origin === targetOrigin) {
        setReady();
      }
    };
    window.addEventListener("message", listener);
  </script>
</apex:page>