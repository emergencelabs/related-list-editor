<template>
  <c-mobile-navigation
    if:true={isMobileNavigation}
    list-label={listLabel}
    count={totalRecordsCountLabel}
    icon-name={iconName}
    object-api-name={objectApiName}
    child-object-api-name={childObjectApiName}
    relationship-field={relationshipField}
    record-id={recordId}
  ></c-mobile-navigation>

  <c-header
    if:true={showHeader}
    icon-name={iconName}
    list-label={listLabel}
    child-object-api-name={childObjectApiName}
    relationship-field={relationshipField}
    record-id={recordId}
    count={totalRecordsCountLabel}
    require-new-modal={requireNewModal}
    allow-edit-modal={allowEditModal}
    reason-for-new-modal={reasonForNewModal}
    ondisplaymodal={launchModal}
  ></c-header>
  <div style="min-height: 100px;" class="slds-is-relative">
    <template if:true={loading}>
      <div class="slds-spinner_container slds-align_absolute-center">
        <div class="slds-is-relative">
          <lightning-spinner
            alternative-text="Loading Records"
            size="small"
            variant="brand"
          ></lightning-spinner>
        </div>
      </div>
    </template>
    <template if:false={loading}>
      <c-tile-list
        if:true={isTileLayout}
        icon-name={iconName}
        records={records}
        object-api-name={objectApiName}
        child-object-label={childObjectLabel}
        child-object-api-name={childObjectApiName}
        relationship-field={relationshipField}
        record-id={recordId}
        columns={columnDetails.columns}
        onrequestdelete={requestDelete}
        is-standalone={isStandalone}
        onviewmore={getNextRecords}
        can-request-more={canRequestMore}
        layout-mode-limit={layoutModeLimit}
      ></c-tile-list>
      <div style="height: 15rem;" if:true={isTableLayout}>
        <div class="slds-is-relative">
          <div if:true={refreshingTable}>
            <lightning-spinner
              alternative-text="Loading Records"
              size="small"
              variant="brand"
            ></lightning-spinner>
          </div>
        </div>
        <c-table
          columns={columnDetails.columns}
          data={records}
          enable-infinite-loading
          hide-checkbox-column
          key-field="Id"
          onloadmore={loadMoreRecords}
          oncellvaluechange={newDraftValue}
          oninvalidcell={setInvalidCell}
          onsort={updateColumnSorting}
          sorted-by={columnDetails.sortDetails.column}
          sorted-direction={columnSortDirection}
          show-row-number-column
        >
        </c-table>
        <!-- <lightning-datatable></lightning-datatable> -->
        <c-table-controls
          if:true={hasUnsavedChanges}
          block-save={blockSave}
        ></c-table-controls>
      </div>
    </template>
  </div>
  <!-- TODO: need to add the 'new' button to the modal here
  if you cannot create them inline
-->
  <c-slotted-modal
    if:true={modalIsOpen}
    modal-title={listLabel}
    onclose={closeModal}
    block-save={blockSave}
    ><div style="min-height: 100px;" class="slds-is-relative">
      <div style="height: 20rem;">
        <div if:true={refreshingTable}>
          <lightning-spinner
            alternative-text="Loading Records"
            size="small"
            variant="brand"
          ></lightning-spinner>
        </div>
        <c-table
          columns={columnDetails.columns}
          data={records}
          enable-infinite-loading
          hide-checkbox-column
          key-field="Id"
          onloadmore={loadMoreRecords}
          oncellvaluechange={newDraftValue}
          sorted-by={columnDetails.sortDetails.column}
          sorted-direction={columnSortDirection}
          onsort={updateColumnSorting}
          show-row-number-column
        >
        </c-table>
      </div>
    </div>
  </c-slotted-modal>
  <c-slotted-modal
    if:true={confirmLoseChanges}
    modal-title="You have unsaved changes"
    onclose={confirmDiscard}
    save-button-label="Discard Changes"
    size="small"
  >
    <div>
      <p class="slds-align_absolute-center slds-m-bottom_small">
        Are you sure you want to discard these changes?
      </p>
    </div></c-slotted-modal
  >
</template>
